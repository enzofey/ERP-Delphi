unit Receber;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.ComCtrls, Vcl.StdCtrls,
  Vcl.Buttons, Data.DB, Vcl.Grids, Vcl.DBGrids,
  GlobalUnit,
  ConsultarEntidadeForm, EntidadeDataModule,
  ReceberDM,
  ImpressaoNFEDataModule, ConsultarFaturaForm;

type
  TReceberForm = class(TForm)
    Panel1: TPanel;
    Pages: TPageControl;
    Acesso: TTabSheet;
    Manutencao: TTabSheet;
    dtEmissaoIni: TLabel;
    dtEmissaoFim: TLabel;
    lblNumero: TLabel;
    lblEntidade: TLabel;
    EdtNumero: TEdit;
    EdtEntidade: TEdit;
    lblNumeroDUPL: TLabel;
    EdtNumeroDUPL: TEdit;
    DTPEmissaoIni: TDateTimePicker;
    DTPEmissaoFim: TDateTimePicker;
    lblVenctoIni: TLabel;
    DTPVenctoIni: TDateTimePicker;
    lblVenctoFim: TLabel;
    DTPVenctoFim: TDateTimePicker;
    lblValorIni: TLabel;
    EdtValorIni: TEdit;
    lblValorFim: TLabel;
    EdtValorFim: TEdit;
    SBEntidade: TSpeedButton;
    Grid: TDBGrid;
    btnFechar: TButton;
    lblFatura: TLabel;
    EdtFatura: TEdit;
    SBFatura: TSpeedButton;
    btnConsultar: TButton;
    lblEntidadeDUPL: TLabel;
    lblFaturaDUPL: TLabel;
    lbldtEmissaoDUPL: TLabel;
    DTPdtEmiDUPL: TDateTimePicker;
    lbldtVenctoDUPL: TLabel;
    EdtEntidadeDUPL: TEdit;
    DTPdtVenctoDUPL: TDateTimePicker;
    EdtFaturaDUPL: TEdit;
    procedure btnFecharClick(Sender: TObject);
    procedure SBEntidadeClick(Sender: TObject);
    procedure SBFaturaClick(Sender: TObject);
    procedure btnConsultarClick(Sender: TObject);
    procedure GridCellClick(Column: TColumn);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  ReceberForm: TReceberForm;

implementation

{$R *.dfm}

procedure TReceberForm.btnConsultarClick(Sender: TObject);
var dtEmissaoFim, dtEmissaoIni, dtVenctoIni, dtVenctoFim: tdate;
    entidade, numero, Fatura: string;
    ValorIni, ValorFim: double;
begin
 dtEmissaoIni := DTPemissaoIni.Date;
 dtEmissaoFim := DTPemissaoFim.Date;
 dtVenctoIni := DTPVenctoIni.Date;
 dtVenctoFim := DTPVenctoFim.Date;
 entidade := EdtEntidade.Text;
 Numero := EdtNumero.Text;
 Fatura := EdtFatura.Text;

 ReceberDataModule.ConsultarReceber.SQL.Clear;
 ReceberDataModule.ConsultarReceber.SQL.Text :=
 'select * from receber ' +
 'where dtemissao >= :dtEmissaoIni and dtemissao <=:dtEmissaoFim ' +
 'and dtvencto >= :dtVenctoIni and dtvencto <=:dtVenctoFim';
 ReceberDataModule.ConsultarReceber.Parambyname('dtEmissaoIni').AsDate := dtEmissaoIni;
 ReceberDataModule.ConsultarReceber.Parambyname('dtEmissaoFim').AsDate := dtEmissaoFim;
 ReceberDataModule.ConsultarReceber.Parambyname('dtVenctoIni').AsDate := dtVenctoIni;
 ReceberDataModule.ConsultarReceber.Parambyname('dtVenctoFim').AsDate := dtVenctoFim;

 if EdtEntidade.Text <> '' then begin
 ReceberDataModule.ConsultarReceber.SQL.Add('and entidade = :entidade');
 ReceberDataModule.ConsultarReceber.ParamByName('entidade').AsString := entidade
 end;

 if EdtNumero.Text <> '' then begin
 ReceberDataModule.ConsultarReceber.SQL.Add('and numero = :numero');
 ReceberDataModule.ConsultarReceber.ParamByName('numero').AsString := numero
 end;

 if EdtFatura.Text <> '' then begin
 ReceberDataModule.ConsultarReceber.SQL.Add('and Fatura = :Fatura');
 ReceberDataModule.ConsultarReceber.ParamByName('Fatura').AsString := Fatura
 end;

 if EdtValorIni.Text <> '' then begin
 TryStrToFloat(EdtValorIni.Text, ValorIni);
 ReceberDataModule.ConsultarReceber.SQL.Add('and Valor >= :ValorIni');
 ReceberDataModule.ConsultarReceber.ParamByName('ValorIni').AsFloat := ValorIni;
 end;

 if EdtValorFim.Text <> '' then begin
 TryStrToFloat(EdtValorFim.Text, ValorFim);
 ReceberDataModule.ConsultarReceber.SQL.Add('and Valor <= :ValorFim');
 ReceberDataModule.ConsultarReceber.ParamByName('ValorFim').AsFloat := ValorFim;
 end;
ReceberDataModule.ConsultarReceber.Open;
end;

procedure TReceberForm.btnFecharClick(Sender: TObject);
begin
 Fechartela(sender);
end;

procedure TReceberForm.GridCellClick(Column: TColumn);
begin
 Pages.ActivePage := Manutencao;
end;

procedure TReceberForm.SBEntidadeClick(Sender: TObject);
var codigo, nome: string;
begin
 CadEntidadeDataModule.ConsultarEntidade.SQL.Clear;
 CadEntidadeDataModule.ConsultarEntidade.SQL.Text :=
 'select * from cadentidade';
 CadEntidadeDataModule.ConsultarEntidade.Open;
 Application.CreateForm(TConsultarEntidade, ConsultarEntidade);

 codigo := ConsultarEntidade.SelecionarEntidade;
 EdtEntidade.Text := ConsultarEntidade.nome;
end;

procedure TReceberForm.SBFaturaClick(Sender: TObject);
var fatura: string;
begin
  ImpressaoNFEFormDataModule.ConsultarFatura.SQL.Clear;
  ImpressaoNFEFormDataModule.ConsultarFatura.SQL.Text :=
  'select * from nota';
  ImpressaoNFEFormDataModule.ConsultarFatura.Open;
  Application.CreateForm(TConsultarFatura, ConsultarFatura);

  fatura := ConsultarFatura.SelecionarFatura;
  EdtFatura.Text := fatura;
end;

end.
